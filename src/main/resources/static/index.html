<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>Warehouse</h1>
  <div class="controls">
    <label>Warehouse ID:</label>
    <input type="text" id="warehouseID" value="001" size="5">

    <label>Standort:</label>
    <input type="text" id="location" value="Linz">

    <label>Produktname:</label>
    <input type="text" id="productName">

    <label>Format:</label>
    <select id="format">
      <option value="json">JSON</option>
      <option value="xml">XML</option>
    </select>

    <button id="load">Daten laden</button>
  </div>

  <div id="warehouseInfo" class="info"></div>

  <table id="productTable">
    <thead>
      <tr>
        <th>Produkt-ID</th>
        <th>Produktname</th>
        <th>Kategorie</th>
        <th>Menge</th>
        <th>Einheit</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function showWarehouseInfo(wh) {
      $('#warehouseInfo').html(
        `<strong>Lager:</strong> ${wh.warehouseName} (ID: ${wh.warehouseID})<br>
         <strong>Timestamp:</strong> ${wh.timestamp}`
      );
    }

    function fillTable(products) {
      const tbody = $('#productTable tbody');
      tbody.empty();
      if (!products || products.length === 0) {
        tbody.append('<tr><td colspan="5">Keine Produkte gefunden</td></tr>');
        return;
      }
      products.forEach(p => {
        tbody.append(`<tr>
          <td>${p.productID}</td>
          <td>${p.productName}</td>
          <td>${p.productCategory}</td>
          <td>${p.productQuantity}</td>
          <td>${p.productUnit}</td>
        </tr>`);
      });
    }

    function handleJson(data) {
      showWarehouseInfo(data);
      fillTable(data.productDataList || []);
    }

    function handleXml(xml) {
      const w = $(xml).find('warehouseData');
      const warehouse = {
        warehouseID: w.find('warehouseID').text(),
        warehouseName: w.find('warehouseName').text(),
        timestamp: w.find('timestamp').text(),
        productDataList: []
      };
      w.find('ProductData').each(function() {
        const p = $(this);
        warehouse.productDataList.push({
          productID: p.find('productID').text(),
          productName: p.find('productName').text(),
          productCategory: p.find('productCategory').text(),
          productQuantity: p.find('productQuantity').text(),
          productUnit: p.find('productUnit').text()
        });
      });
      showWarehouseInfo(warehouse);
      fillTable(warehouse.productDataList);
    }

    $('#load').click(function() {
      const id = $('#warehouseID').val().trim();
      const fmt = $('#format').val();
      const loc = $('#location').val().trim();
      const pname = $('#productName').val().trim();

      let url = `/warehouse/${id}/${fmt}`;
      const params = [];
      if (loc) params.push('location=' + encodeURIComponent(loc));
      if (pname) params.push('productName=' + encodeURIComponent(pname));
      if (params.length > 0) url += '?' + params.join('&');

      const accept = fmt === 'xml' ? 'application/xml' : 'application/json';
      $.ajax({
        url: url,
        headers: { 'Accept': accept },
        success: function(data) {
          if (fmt === 'xml') handleXml(data);
          else handleJson(data);
        },
      });
    });

    $(function() { $('#load').click(); });
  </script>
</body>
</html>
